{% extends 'grades/base.html' %}
{% load static %}

{% block title %}æˆ‘çš„èª²ç¨‹ - æ•™å¸«é¢æ¿{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row">
        <div class="col-md-12">
            <h1 class="mb-4">
                ï¿½â€ğŸ« æ•™å¸«ä¸­å¿ƒ - æˆ‘çš„èª²ç¨‹
                <span class="badge badge-primary" style="background-color: #007bff;">{{ courses.count }} é–€èª²ç¨‹</span>
            </h1>
            
            <!-- æ•™å¸«ä¸­å¿ƒå°èˆª -->
            <div class="mb-4">
                <a href="{% url 'grades:main' %}" class="btn btn-outline-secondary">ğŸ  å›åˆ°ä¸»é </a>
                <a href="{% url 'grades:add_course_teacher' %}" class="btn btn-success">â• æ–°å¢èª²ç¨‹</a>
                <a href="/admin/" class="btn btn-info" target="_blank">âš™ï¸ å¾Œå°ç®¡ç†</a>
            </div>

            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                {% endfor %}
            {% endif %}

            <!-- æ•™å¸«è³‡è¨Šå¡ -->
            <div class="card mb-4" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <div class="card-body">
                    <h5 class="card-title">ğŸ‘¨â€ğŸ« æ•™å¸«è³‡è¨Š</h5>
                    <p class="mb-1"><strong>å§“å:</strong> {{ teacher.user.last_name }}{{ teacher.user.first_name }}</p>
                    <p class="mb-1"><strong>ç³»åˆ¥:</strong> {{ teacher.department }}</p>
                    <p class="mb-1"><strong>è¾¦å…¬å®¤:</strong> {{ teacher.office }}</p>
                    <p class="mb-1"><strong>é›»è©±:</strong> {{ teacher.phone }}</p>
                    <p class="mb-0"><strong>è¾¦å…¬æ™‚é–“:</strong> {{ teacher.office_hours }}</p>
                </div>
            </div>

            <!-- èª²ç¨‹åˆ—è¡¨ -->
            {% if courses %}
                <div class="row">
                    {% for course in courses %}
                        <div class="col-md-6 mb-4">
                            <div class="card shadow-sm">
                                <div class="card-body">
                                    <h5 class="card-title">{{ course.name }}</h5>
                                    <p class="card-text text-muted">ä»£ç¢¼: <strong>{{ course.code }}</strong></p>
                                    
                                    <div class="mb-3">
                                        <small class="d-block">ğŸ“– æè¿°: {{ course.description|truncatewords:15 }}</small>
                                        <small class="d-block">ğŸ“Š å­¸åˆ†: <strong>{{ course.credits }}</strong></small>
                                        <small class="d-block">ğŸ‘¥ å®¹é‡: <strong>{{ course.capacity }}</strong></small>
                                    </div>

                                    <!-- é¸èª²äººæ•¸é¡¯ç¤º -->
                                    {% with enrollments=course.enrollments.count %}
                                        <div class="mb-3">
                                            <div class="progress" style="height: 25px;">
                                                <div class="progress-bar" 
                                                     role="progressbar" 
                                                     style="width: {% widthratio enrollments course.capacity 100 %}%"
                                                     aria-valuenow="{{ enrollments }}" 
                                                     aria-valuemin="0" 
                                                     aria-valuemax="{{ course.capacity }}">
                                                    {{ enrollments }}/{{ course.capacity }}
                                                </div>
                                            </div>
                                        </div>

                                        <!-- ç‹€æ…‹æŒ‡ç¤º -->
                                        <div class="mb-3">
                                            {% if enrollments == 0 %}
                                                <span class="badge badge-secondary">âšª æœªé–‹èª²</span>
                                            {% elif enrollments >= course.capacity %}
                                                <span class="badge badge-danger">ğŸ”´ å·²æ»¿ç­</span>
                                            {% else %}
                                                <span class="badge badge-success">ğŸŸ¢ æ­£å¸¸</span>
                                            {% endif %}
                                        </div>
                                    {% endwith %}

                                    <!-- æ“ä½œæŒ‰éˆ• -->
                                    <a href="{% url 'grades:course_students' course.id %}" class="btn btn-sm btn-info">
                                        ğŸ‘¥ æŸ¥çœ‹å­¸ç”Ÿ ({{ course.enrollments.count }})
                                    </a>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="alert alert-info text-center">
                    <h5>ğŸ“­ é‚„æ²’æœ‰èª²ç¨‹</h5>
                    <p>è«‹ä½¿ç”¨ç³»çµ±ç®¡ç†å“¡å¸³è™Ÿåœ¨å¾Œå°ç®¡ç†ç³»çµ±ä¸­æ–°å¢èª²ç¨‹</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
    .card {
        transition: transform 0.2s, box-shadow 0.2s;
    }
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2) !important;
    }
    .badge {
        padding: 0.5rem 0.75rem;
        font-size: 0.875rem;
    }
    .progress {
        border-radius: 0.25rem;
    }
    .progress-bar {
        font-weight: bold;
        color: white;
    }
</style>
{% endblock %}
