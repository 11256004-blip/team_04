{% extends 'grades/base.html' %}
{% load static %}

{% block title %}ç·¨è¼¯æˆç¸¾{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-body">
                    <h2 class="card-title mb-4">âœï¸ ç·¨è¼¯å­¸ç”Ÿæˆç¸¾</h2>

                    {% if messages %}
                        {% for message in messages %}
                            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                                {{ message }}
                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                        {% endfor %}
                    {% endif %}

                    <!-- å­¸ç”Ÿå’Œèª²ç¨‹è³‡è¨Š -->
                    <div class="card mb-4" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6 class="text-uppercase text-muted" style="color: rgba(255, 255, 255, 0.7);">å­¸ç”Ÿ</h6>
                                    <p class="h5 mb-0">{{ enrollment.student.last_name }}{{ enrollment.student.first_name }}</p>
                                    <small>å¸³è™Ÿ: {{ enrollment.student.username }}</small>
                                </div>
                                <div class="col-md-6">
                                    <h6 class="text-uppercase text-muted" style="color: rgba(255, 255, 255, 0.7);">èª²ç¨‹</h6>
                                    <p class="h5 mb-0">{{ enrollment.course.name }}</p>
                                    <small>{{ enrollment.course.code }}</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <form method="POST" novalidate>
                        {% csrf_token %}

                        <!-- æœŸä¸­æˆç¸¾ -->
                        <div class="form-group mb-4">
                            <label for="id_midterm_score" class="form-label">ğŸ“ æœŸä¸­æˆç¸¾</label>
                            <div class="input-group">
                                {{ form.midterm_score }}
                                <span class="input-group-text">/ 100</span>
                            </div>
                            {% if form.midterm_score.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.midterm_score.errors|join:", " }}
                                </div>
                            {% endif %}
                            <small class="form-text text-muted">è¼¸å…¥ 0-100 ä¹‹é–“çš„æ•¸å­—ï¼Œæˆ–ç•™ç©ºè¡¨ç¤ºæœªè©•åˆ†</small>
                        </div>

                        <!-- æœŸæœ«æˆç¸¾ -->
                        <div class="form-group mb-4">
                            <label for="id_final_score" class="form-label">ğŸ“ æœŸæœ«æˆç¸¾</label>
                            <div class="input-group">
                                {{ form.final_score }}
                                <span class="input-group-text">/ 100</span>
                            </div>
                            {% if form.final_score.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.final_score.errors|join:", " }}
                                </div>
                            {% endif %}
                            <small class="form-text text-muted">è¼¸å…¥ 0-100 ä¹‹é–“çš„æ•¸å­—ï¼Œæˆ–ç•™ç©ºè¡¨ç¤ºæœªè©•åˆ†</small>
                        </div>

                        <!-- å¹³å‡æˆç¸¾é¡¯ç¤º -->
                        <div class="card bg-light mb-4">
                            <div class="card-body">
                                <h6 class="card-title">å¹³å‡æˆç¸¾</h6>
                                {% if enrollment.average %}
                                    <p class="h4 mb-0">
                                        <span class="badge" style="background-color: {% if enrollment.average >= 80 %}#4CAF50{% elif enrollment.average >= 70 %}#2196F3{% elif enrollment.average >= 60 %}#FF9800{% else %}#F44336{% endif %}; padding: 0.5rem 1rem; font-size: 1.2rem;">
                                            {{ enrollment.average|floatformat:1 }}
                                        </span>
                                    </p>
                                {% else %}
                                    <p class="text-muted">å°šæœªè¨ˆç®—</p>
                                {% endif %}
                            </div>
                        </div>

                        <!-- æ“ä½œæŒ‰éˆ• -->
                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-success btn-lg flex-grow-1">
                                âœ… ä¿å­˜æˆç¸¾
                            </button>
                            <a href="{% url 'grades:course_students' enrollment.course.id %}" class="btn btn-secondary btn-lg">
                                âŒ å–æ¶ˆ
                            </a>
                        </div>
                    </form>

                    <!-- ç­‰ç´šèªªæ˜ -->
                    <div class="alert alert-info mt-4">
                        <h6>ğŸ“Š ç­‰ç´šèªªæ˜:</h6>
                        <table class="mb-0 small">
                            <tr>
                                <td><span class="badge" style="background-color: #4CAF50; padding: 0.3rem 0.6rem;">A</span></td>
                                <td>80 åˆ†ä»¥ä¸Š</td>
                            </tr>
                            <tr>
                                <td><span class="badge" style="background-color: #2196F3; padding: 0.3rem 0.6rem;">B</span></td>
                                <td>70 - 79 åˆ†</td>
                            </tr>
                            <tr>
                                <td><span class="badge" style="background-color: #FF9800; padding: 0.3rem 0.6rem;">C</span></td>
                                <td>60 - 69 åˆ†</td>
                            </tr>
                            <tr>
                                <td><span class="badge" style="background-color: #F44336; padding: 0.3rem 0.6rem;">D</span></td>
                                <td>60 åˆ†ä»¥ä¸‹</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .form-control, .form-control:focus {
        border-radius: 0.5rem;
    }
    .form-control:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
    }
    .btn-lg {
        padding: 0.75rem 1.5rem;
        font-size: 1.1rem;
    }
    .input-group-text {
        background-color: #f8f9fa;
        border-color: #ddd;
    }
    .invalid-feedback {
        color: #dc3545;
        margin-top: 0.25rem;
        font-size: 0.875rem;
    }
    .badge {
        color: white;
        font-weight: bold;
    }
</style>
{% endblock %}
