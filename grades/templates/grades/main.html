{% extends 'grades/base.html' %}

{% block content %}
  {% if message %}
    <div class="message error">
      âš ï¸ {{ message }}
    </div>
  {% endif %}

  {% if student %}
    <!-- å­¸ç”Ÿè³‡è¨Šå¡ç‰‡ -->
    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                border-radius: 15px; 
                padding: 30px; 
                color: white;
                margin-bottom: 30px;
                display: flex;
                gap: 30px;
                align-items: center;
                box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);">
      
      <!-- é ­åƒ -->
      <div style="flex: 0 0 120px;">
        <div style="background: rgba(255,255,255,0.2); 
                    border-radius: 50%; 
                    width: 120px; 
                    height: 120px; 
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    overflow: hidden;
                    border: 3px solid rgba(255,255,255,0.3);">
          {% if profile.avatar %}
            <img src="{{ profile.avatar.url }}" alt="é ­åƒ" style="width: 100%; height: 100%; object-fit: cover;">
          {% else %}
            <div style="font-size: 60px;">ğŸ‘¤</div>
          {% endif %}
        </div>
      </div>
      
      <!-- å€‹äººè³‡è¨Š -->
      <div style="flex: 1;">
        <h2 style="color: white; border: none; margin-bottom: 10px;">
          ï¿½ æ­¡è¿ï¼Œ{{ student.first_name }} {{ student.last_name }}
        </h2>
        <p style="font-size: 0.95em; opacity: 0.95;">
          <strong>ç”¨æˆ¶åï¼š</strong> {{ student.username }}
        </p>
        {% if profile.bio %}
          <p style="font-size: 0.95em; opacity: 0.9; margin-top: 8px;">
            {{ profile.bio }}
          </p>
        {% endif %}
        <div class="btn-group" style="margin-top: 15px; gap: 10px;">
          <a href="{% url 'grades:profile' %}" class="btn" style="background: rgba(255,255,255,0.2); border: 2px solid white; padding: 8px 16px; font-size: 0.9em;">âœï¸ ç·¨è¼¯è³‡è¨Š</a>
          {% if request.user.teacher_profile %}
          <a href="{% url 'grades:teacher_courses' %}" class="btn" style="background: rgba(255,193,7,0.8); border: 2px solid #ffc107; padding: 8px 16px; font-size: 0.9em;">ğŸ‘¨â€ğŸ« æ•™å¸«ä¸­å¿ƒ</a>
          {% endif %}
        </div>
      </div>
    </div>

    <h2>ğŸ‘¨â€ğŸ“ æˆ‘çš„ä¿®èª²è³‡æ–™</h2>
    
    <div class="btn-group">
      <a href="{% url 'grades:add_course' %}" class="btn">â• æ–°å¢èª²ç¨‹</a>
      <a href="{% url 'grades:enroll' %}" class="btn btn-secondary">ğŸ“ åŠ é¸èª²ç¨‹</a>
    </div>

    <h3>ğŸ“– ä¿®èª²åˆ—è¡¨</h3>
    {% if enrollments %}
      <table>
        <thead>
          <tr>
            <th>èª²ç¨‹åç¨±</th>
            <th style="text-align: center;">æˆèª²æ•™å¸«</th>
            <th style="text-align: center;">æœŸä¸­æˆç¸¾</th>
            <th style="text-align: center;">æœŸæœ«æˆç¸¾</th>
            <th style="text-align: center;">å¹³å‡</th>
            <th style="text-align: center;">æ“ä½œ</th>
          </tr>
        </thead>
        <tbody>
          {% for e in enrollments %}
            <tr>
              <td>
                <a href="{% url 'grades:course_detail' e.course.id %}">
                  ğŸ“š {{ e.course.name }}
                </a>
              </td>
              <td style="text-align: center;">{{ e.course.teacher }}</td>
              <td style="text-align: center;">
                {% if e.midterm_score %}
                  <strong>{{ e.midterm_score }}</strong>
                {% else %}
                  <span style="color: #999;">-</span>
                {% endif %}
              </td>
              <td style="text-align: center;">
                {% if e.final_score %}
                  <strong>{{ e.final_score }}</strong>
                {% else %}
                  <span style="color: #999;">-</span>
                {% endif %}
              </td>
              <td style="text-align: center;">
                {% if e.average %}
                  <strong style="color: #667eea;">{{ e.average|floatformat:2 }}</strong>
                {% else %}
                  <span style="color: #999;">-</span>
                {% endif %}
              </td>
              <td style="text-align: center;">
                <div class="btn-group">
                  <a href="{% url 'grades:course_comments' e.course.id %}" class="btn btn-primary btn-small">
                    ğŸ’¬ èª²ç¨‹ç•™è¨€
                  </a>
                  <a href="{% url 'grades:unenroll' e.id %}" class="btn btn-danger btn-small" 
                     onclick="return confirm('ç¢ºå®šè¦é€€é¸ã€Œ{{ e.course.name }}ã€å—ï¼Ÿ')">
                    âŒ é€€é¸
                  </a>
                </div>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>

      <div class="stats-card">
        <h4>ğŸ“Š å­¸æœŸç¸½æˆç¸¾</h4>
        <div class="stats-value">
          {% if overall_avg %}
            {{ overall_avg|floatformat:2 }} åˆ†
          {% else %}
            å°šç„¡æˆç¸¾
          {% endif %}
        </div>
      </div>
    {% else %}
      <div class="empty-state">
        <div class="empty-state-icon">ğŸ“­</div>
        <p style="font-size: 1.2em; color: #666;">å°šç„¡ä¿®èª²ç´€éŒ„</p>
        <p>é»æ“Šä¸Šæ–¹ã€ŒåŠ é¸èª²ç¨‹ã€é–‹å§‹é¸èª²å§ï¼</p>
      </div>
    {% endif %}
  {% else %}
    <div class="empty-state">
      <div class="empty-state-icon">ğŸ‘‹</div>
      <h2>æ­¡è¿ä½¿ç”¨æˆç¸¾ç³»çµ±</h2>
      <p>è«‹å…ˆå»ºç«‹ä½¿ç”¨è€…èˆ‡èª²ç¨‹è³‡æ–™ã€‚</p>
    </div>
  {% endif %}
{% endblock %}
